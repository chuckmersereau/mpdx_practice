<h2 translate>Expected Monthly Total</h2>
<uib-progress ng-if="!$ctrl.errorOccurred" class="report-progress-bar">
    <uib-bar ng-repeat="donationType in $ctrl.donationsByType | orderBy: 'order'"
             value="$ctrl.percentage(donationType)"
             type="{{donationType.type === 'received' ? 'success' : (donationType.type === 'likely' ? 'default' : 'danger')}}"
             uib-tooltip="{{$ctrl.total_currency_symbol}}{{donationType.sum | number : 0}}"
             tooltip-placement="bottom">
    <span ng-if="$ctrl.percentage(donationType) > 7" ng-switch="donationType.type">
      <span ng-switch-when="received"><%= _('Received') %></span>
      <span ng-switch-when="likely"><%= _('Likely') %></span>
      <span ng-switch-when="unlikely"><%= _('Possible') %></span>
    </span>
    </uib-bar>
</uib-progress>
<div ng-if="$ctrl.errorOccurred" translate>
    Report data could not load due to an error. Please try again or contact support.
</div>
<div ng-if="!$ctrl.errorOccurred" ng-repeat="donationType in $ctrl.donationsByType | orderBy: 'order'">
    <div class="panel panel-default panel-report">
        <div class="panel-body panel-report-heading panel-report-heading-collapsible" ng-click="tableCollapsed = !tableCollapsed" ng-init="tableCollapsed = true">
            <div class="row" ng-switch="donationType.type">
                <div class="col-xs-6">
                    <h4>
                        <span ng-switch-when="received"><%= _('Donations So Far This Month') %></span>
                        <span ng-switch-when="likely"><%= _('Likely Partners This Month') %></span>
                        <span ng-switch-when="unlikely"><%= _('Possible Partners This Month') %></span>
                        <span ng-switch-default>{{ donationType.type }}</span>
                        <i class="fa fa-chevron-down collapsible-heading-arrow" aria-hidden="true" ng-if="tableCollapsed"></i>
                        <i class="fa fa-chevron-up collapsible-heading-arrow" aria-hidden="true" ng-if="!tableCollapsed"></i>
                        <small class="collapsible-heading-count">
                            <ng-pluralize ng-if="tableCollapsed" count="donationType.donations.length || 0"
                                          when="{'0': '{{('No partners') %>',
                                 'one': '<%= _('Show 1 partner') %>',
                                 'other': '<%= _('Show {} partners') %>'}"></ng-pluralize>
                        </small>
                    </h4>
                </div>
                <div class="col-xs-6 text-right">
                    <h4>
                        <span ng-switch-when="received"><%= _('Monthly Total So Far') %>:</span>
                        <span ng-switch-when="likely"><%= _('Likely Additional') %>:</span>
                        {{$ctrl.total_currency_symbol}}{{donationType.sum | number : 0}}
                        {{$ctrl.total_currency}}
                    </h4>
                </div>
            </div>
        </div>
        <div class="table-responsive" ng-if="donationType.donations" uib-collapse="tableCollapsed">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th style="width: 30%"><%= _('Partner') %></th>
                    <th style="width: 20%"><%= _('Status') %></th>
                    <th style="width: 10%" class="text-right"><%= _('Commitment') %></th>
                    <th style="width: 15%" class="text-right"><%= _('Frequency') %></th>
                    <th style="width: 15%" class="text-right"><span ng-if="donationType.type === 'received'"><%= _('Donation') %></span></th>
                    <th style="width: 10%" class="text-right"><%= _('Converted') %></th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="donation in donationType.donations | orderBy : 'donor'">
                    <td><a href="/contacts/{{donation.contact_id}}" target="_blank">{{donation.donor}}</a></td>
                    <td>{{donation.status}}</td>
                    <td class="text-right">
                        <div ng-if="donation.pledge_amount !== null">
                            {{donation.pledge_currency_symbol}}{{donation.pledge_amount | number : 0}}
                            {{donation.pledge_currency}}
                        </div>
                    </td>
                    <td class="text-right">{{donation.pledge_frequency}}</td>
                    <td class="text-right">
            <span ng-if="donationType.type === 'received'">
              {{donation.donation_currency_symbol}}{{donation.donation_amount | number : 0 }}
              {{donation.donation_currency}}
            </span>
                    </td>
                    <td class="text-right">
                        {{donation.converted_currency_symbol}}{{donation.converted_amount | number : 0}}
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="panel-footer" ng-if="!donationType.donations" uib-collapse="tableCollapsed">
            <%= _('No partners found in this category') %>
        </div>
    </div>
</div>
